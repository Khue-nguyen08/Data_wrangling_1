---
title: "Data Tidy"
output: github_document
---

```{r set up, echo = FALSE, meessage = FALSE}
library(tidyverse)
library(readxl)
library(haven)
```

Let's import a dataset
```{r}
litters_df = 
  read_csv("data/FAS_litters.csv")
```
```{r}
pup_df = 
  read_csv (
    "data/FAS_pups.csv", 
    skip = 3,
    na = c ("NA", ".", "")
  )
getwd()
```
```{r}
mlb_df =
   read_excel("data/mlb11.xlsx")
```

Import LotR word counts
```{r}
fortr_df =
  read_excel("data/LotR_Words.xlsx", range = "B3:D6")


```
Import the PULSE 

```{r}
pulse_df = 
  read_sas ("data/public_pulse_data.sas7bdat")
```

What about data exporting 
```{r}
write_csv(pup_df, "pup.csv")
```

```{r}
options(tibble.print_min = 3)
litters_df = 
  read_csv("./data/FAS_litters.csv", na = c("NA", ".", ""))
```
 
 Note: wide data often grouped by a character as a column. A long format separate this grouped character out and list it as repeated variable.
human readability vs computer readability
Relational data: tables are combined by joins
Inner joins: taking the same input, remove the unmatched
outer joins: including left, right, full
Left: including the first data set, add-on the matched ones from the second one
Right: including the second one
Full: including all the data, put NA on the unmatched ones
Combining multiple tables: bind_rows; *_join
## Pivot longer
```{r}
options(tibble.print_min = 5)
pulse_df = 
  read_sas ("data/public_pulse_data.sas7bdat") |>
  janitor::clean_names() |>
  pivot_longer(
    cols = bdi_score_bl : bdi_score_12m, # this columns has the names and has the values
    names_to = "visit",
    values_to = "bdi_score",
    names_prefix = "bdi_score_"
  ) |>
  mutate (visit = replace( visit, visit == "bl", "00m")) |>
  relocate (id, visit)
```

Do one more example
```{r}
litters_df = 
  read_csv("./data/FAS_litters.csv", na = c("NA", ".", "")) |>
  janitor:: clean_names() |>
  pivot_longer(
    cols= gd0_weight:gd18_weight, 
    names_to = "gd_time",
    values_to = "weight",
  ) |>
  mutate(gd_time = case_match(
    gd_time,
    "gd0_weight" ~ 0,
    "gd18_weight" ~ 18
  ))

```

## Pivot wider
 Make up a table
```{r}
analysis_df =
  tibble( group = c ("treatment", "treatment", "control","control"),
          time = c("pre", "post", "pre", "post"),
          mean = c (4,10,2.5,5))

```

Pivot it wider
When to use the wider: useful to add in the fomrula to have a new variable. For example to compare pre treatment and post treatment
```{r}
analysis_df |>
  pivot_wider(
    names_from = time,
    values_from = mean,
    
  ) |>
  knitr::kable()
```
 
## Bind tables
```{r}
fellowship_ring = 
  read_excel("data/lotR_Words.xlsx", range = "B3:D6") |>
  mutate( movie = "fellowship_ring")
two_towers = 
  read_excel("data/lotR_Words.xlsx", range = "F3:H6") |>
  mutate (movie = "two_towers")
return_king = 
  read_excel("data/lotR_Words.xlsx", range = "J3:L6") |>
  mutate (movie = "rerurn_king")
lotr_df = 
  bind_rows(fellowship_ring, two_towers, return_king) |>
  pivot_longer(
    cols= Female : Male,
    names_to ="sex",
    values_to = "words"
  ) |>
  relocate(movie) |>
  mutate(Race = str_to_lower(Race),
         sex = str_to_lower(sex))
```

 ## Join FAS datasets
```{r}
litters_df = 
  read_csv("./data/FAS_litters.csv", na = c("NA", ".", "")) |>
  janitor:: clean_names() |>
  mutate(wt_gain = gd18_weight - gd0_weight) |>
  separate (
    group, into = c ("dose", "day_of_treatment"),sep = 3
  )
```
 Import pups data
```{r}
pub_df = 
  read_csv("./data/FAS_pups.csv", na = c ("NA", ".", "")) |>
  janitor:: clean_names()
```
 Join the datasets 
```{r}

```
 

